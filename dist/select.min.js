var SelectCSS;
/**
 * Dimas Lanjaka Advanced Select
 * @param target string
 */
class dS {
    constructor(target, settings) {
        this.target = null;
        this.select = null;
        this.display = null;
        this.list = null;
        this.options = [];
        this.isLarge = false;
        this.value = null;
        this.selected = null;
        this.settings = null;
        this.highlighted = null;
        this.filter = null;
        this.target = target;
        this.select = null;
        this.display = null;
        this.list = null;
        this.options = [];
        this.isLarge = false;
        this.value = null;
        this.selected = null;
        this.settings = settings;
        this.highlighted = null;
        if (settings.hasOwnProperty('start') && settings.start)
            this.init();
    }
    /**
     * Initialize Select
     */
    init() {
        switch (typeof this.target) {
            case 'object':
                this.target = this.target;
                break;
            case 'string':
                this.target = document.querySelector(this.target);
                break;
        }
        if (!SelectCSS && this.settings.hasOwnProperty('css')) {
            SelectCSS = true;
            this.loadCss(this.settings.css);
        }
        this.settings = this.getSettings(this.settings);
        this.buildSelect();
        this.target.parentNode.replaceChild(this.select, this.target);
        this.target.style.display = 'none';
        this.select.appendChild(this.target);
        document.addEventListener('click', this.handleClickOff.bind(this));
        this.positionList();
    }
    ;
    loadCss(url) {
        var link = document.createElement("link");
        link.type = "text/css";
        link.rel = "stylesheet";
        link.href = url;
        document.getElementsByTagName("head")[0].appendChild(link);
    }
    ;
    buildSelect() {
        this.select = document.createElement('div');
        this.select.classList.add('select');
        this.select.setAttribute('tabindex', this.target.tabIndex);
        this.select.addEventListener('keydown', this.handleSelectKeydown.bind(this));
        this.display = document.createElement('span');
        this.display.classList.add('value');
        this.display.addEventListener('click', this.handleDisplayClick.bind(this));
        this.select.appendChild(this.display);
        this.buildList();
        if (this.options.length) {
            this.value = this.options[this.target.selectedIndex].getAttribute('data-value');
            this.selected = this.options[this.target.selectedIndex];
            this.display.innerHTML = this.selected.innerHTML;
        }
        if ((this.settings.filtered === 'auto' && this.options.length >= this.settings.filter_threshold) ||
            this.settings.filtered === true) {
            this.isLarge = true;
            this.select.classList.add('large');
        }
    }
    ;
    buildList() {
        this.list = document.createElement('div');
        this.list.classList.add('list');
        this.list.setAttribute('tabindex', '-1');
        this.list.addEventListener('keydown', this.handleListKeydown.bind(this));
        this.list.addEventListener('mouseenter', function () {
            this.options[this.highlighted].classList.remove('hovered');
        }.bind(this));
        this.highlighted = this.target.selectedIndex;
        this.buildFilter();
        this.buildOptions();
        this.select.appendChild(this.list);
    }
    ;
    buildOptions() {
        var ul = document.createElement('ul');
        var options = this.target.querySelectorAll('option');
        for (var i = 0; i < options.length; i++) {
            var li = document.createElement('li');
            li.setAttribute('data-value', options[i].value);
            li.innerHTML = options[i].innerHTML;
            li.addEventListener('click', this.handleOptionClick.bind(this));
            ul.appendChild(li);
            this.options.push(li);
        }
        this.list.appendChild(ul);
    }
    ;
    buildFilter() {
        var wrapper = document.createElement('div');
        wrapper.classList.add('filter');
        this.filter = document.createElement('input');
        this.filter.type = 'text';
        this.filter.setAttribute('placeholder', this.settings.filter_placeholder);
        this.filter.addEventListener('keyup', this.handleFilterKeyup.bind(this));
        wrapper.appendChild(this.filter);
        this.list.appendChild(wrapper);
    }
    ;
    toggleList() {
        if (this.list.classList.contains('open')) {
            this.list.classList.remove('open');
            this.options[this.highlighted].classList.remove('hovered');
            this.select.focus();
        }
        else {
            this.options[this.target.selectedIndex].classList.add('hovered');
            this.highlighted = this.target.selectedIndex;
            this.list.classList.add('open');
            this.list.focus();
        }
    }
    ;
    positionList() {
        if (!this.isLarge) {
            this.list.style.top = '-' + this.selected.offsetTop + 'px';
        }
    }
    ;
    highlightOption(dir) {
        var next = null;
        switch (dir) {
            case 'up':
                next = (this.highlighted - 1 < 0) ? this.highlighted : this.highlighted - 1;
                break;
            case 'down':
                next = (this.highlighted + 1 > this.options.length - 1) ? this.highlighted : this.highlighted + 1;
                break;
            default:
                next = this.highlighted;
        }
        this.options[this.highlighted].classList.remove('hovered');
        this.options[next].classList.add('hovered');
        this.highlighted = next;
    }
    ;
    clearFilter() {
        this.filter.value = '';
        for (var i = 0; i < this.options.length; i++) {
            this.options[i].style.display = 'block';
        }
    }
    ;
    closeList() {
        this.list.classList.remove('open');
        this.options[this.highlighted].classList.remove('hovered');
    }
    ;
    getSettings(settings) {
        var defaults = {
            filtered: 'auto',
            filter_threshold: 8,
            filter_placeholder: 'Filter options...'
        };
        for (var p in settings) {
            defaults[p] = settings[p];
        }
        return defaults;
    }
    ;
    // EVENT HANDLERS
    handleSelectKeydown(e) {
        if (this.select === document.activeElement && e.keyCode == 32) {
            this.toggleList();
        }
    }
    ;
    handleDisplayClick(e) {
        this.list.classList.add('open');
        if (this.isLarge) {
            this.filter.focus();
        }
    }
    ;
    handleListKeydown(e) {
        if (this.list === document.activeElement) {
            switch (e.keyCode) {
                case 38:
                    this.highlightOption('up');
                    break;
                case 40:
                    this.highlightOption('down');
                    break;
                case 13:
                    this.target.value = this.options[this.highlighted].getAttribute('data-value');
                    this.selected = this.options[this.highlighted];
                    this.display.innerHTML = this.options[this.highlighted].innerHTML;
                    this.closeList();
                    setTimeout(this.positionList.bind(this), 200);
                    this.select.focus();
                    break;
            }
        }
    }
    ;
    handleFilterKeyup(e) {
        var self = this;
        this.options.filter(function (li) {
            if (li.innerHTML.substring(0, self.filter.value.length).toLowerCase() == self.filter.value.toLowerCase()) {
                li.style.display = 'block';
            }
            else {
                li.style.display = 'none';
            }
        });
    }
    ;
    handleOptionClick(e) {
        this.display.innerHTML = e.target.innerHTML;
        this.target.value = e.target.getAttribute('data-value');
        this.value = this.target.value;
        this.selected = e.target;
        this.closeList();
        this.clearFilter();
        setTimeout(this.positionList.bind(this), 200);
    }
    ;
    handleClickOff(e) {
        if (!this.select.contains(e.target)) {
            this.closeList();
        }
    }
    ;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlbGVjdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFJLFNBQWtCLENBQUM7QUFDdkI7OztHQUdHO0FBQ0gsTUFBTSxFQUFFO0lBWVAsWUFBWSxNQUFjLEVBQUUsUUFzQjNCO1FBakNELFdBQU0sR0FBRyxJQUFJLENBQUM7UUFDZCxXQUFNLEdBQUcsSUFBSSxDQUFDO1FBQ2QsWUFBTyxHQUFHLElBQUksQ0FBQztRQUNmLFNBQUksR0FBRyxJQUFJLENBQUM7UUFDWixZQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2IsWUFBTyxHQUFHLEtBQUssQ0FBQztRQUNoQixVQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ2IsYUFBUSxHQUFHLElBQUksQ0FBQztRQUNoQixhQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBQ25CLFdBQU0sR0FBRyxJQUFJLENBQUM7UUF3QmIsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7UUFDbkIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDcEIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7UUFDbEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7UUFDckIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDbEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDckIsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7UUFDekIsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7UUFDeEIsSUFBSSxRQUFRLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxJQUFJLFFBQVEsQ0FBQyxLQUFLO1lBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3JFLENBQUM7SUFDRDs7T0FFRztJQUNILElBQUk7UUFDSCxRQUFRLE9BQU8sSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUMzQixLQUFLLFFBQVE7Z0JBQ1osSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO2dCQUMxQixNQUFNO1lBQ1AsS0FBSyxRQUFRO2dCQUNaLElBQUksQ0FBQyxNQUFNLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ2xELE1BQU07U0FDUDtRQUNELElBQUksQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDdEQsU0FBUyxHQUFHLElBQUksQ0FBQztZQUNqQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDaEM7UUFDRCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2hELElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDOUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztRQUNuQyxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDckMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ25FLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUNyQixDQUFDO0lBQUEsQ0FBQztJQUNGLE9BQU8sQ0FBQyxHQUFXO1FBQ2xCLElBQUksSUFBSSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDMUMsSUFBSSxDQUFDLElBQUksR0FBRyxVQUFVLENBQUM7UUFDdkIsSUFBSSxDQUFDLEdBQUcsR0FBRyxZQUFZLENBQUM7UUFDeEIsSUFBSSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7UUFDaEIsUUFBUSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM1RCxDQUFDO0lBQUEsQ0FBQztJQUNGLFdBQVc7UUFDVixJQUFJLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDNUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3BDLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzNELElBQUksQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUM3RSxJQUFJLENBQUMsT0FBTyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDOUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3BDLElBQUksQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUMzRSxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDdEMsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ2pCLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUU7WUFDeEIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ2hGLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQ3hELElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDO1NBQ2pEO1FBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxLQUFLLE1BQU0sSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDO1lBQy9GLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxLQUFLLElBQUksRUFBRTtZQUNqQyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztZQUNwQixJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDbkM7SUFDRixDQUFDO0lBQUEsQ0FBQztJQUNGLFNBQVM7UUFDUixJQUFJLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDMUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN6QyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDekUsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxZQUFZLEVBQUU7WUFDeEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM1RCxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDZCxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDO1FBQzdDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDcEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFBQSxDQUFDO0lBQ0YsWUFBWTtRQUNYLElBQUksRUFBRSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdEMsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNyRCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUN4QyxJQUFJLEVBQUUsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3RDLEVBQUUsQ0FBQyxZQUFZLENBQUMsWUFBWSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNoRCxFQUFFLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFDcEMsRUFBRSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDaEUsRUFBRSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNuQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztTQUN0QjtRQUNELElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzNCLENBQUM7SUFBQSxDQUFDO0lBQ0YsV0FBVztRQUNWLElBQUksT0FBTyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDNUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDaEMsSUFBSSxDQUFDLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzlDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQztRQUMxQixJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBQzFFLElBQUksQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUN6RSxPQUFPLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNqQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBQUEsQ0FBQztJQUNGLFVBQVU7UUFDVCxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUN6QyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDbkMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUMzRCxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1NBQ3BCO2FBQ0k7WUFDSixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNqRSxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDO1lBQzdDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNoQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1NBQ2xCO0lBQ0YsQ0FBQztJQUFBLENBQUM7SUFDRixZQUFZO1FBQ1gsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDbEIsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7U0FDM0Q7SUFDRixDQUFDO0lBQUEsQ0FBQztJQUNGLGVBQWUsQ0FBQyxHQUFHO1FBQ2xCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQztRQUNoQixRQUFRLEdBQUcsRUFBRTtZQUNaLEtBQUssSUFBSTtnQkFDUixJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUM7Z0JBQzVFLE1BQU07WUFDUCxLQUFLLE1BQU07Z0JBQ1YsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDO2dCQUNsRyxNQUFNO1lBQ1A7Z0JBQ0MsSUFBSSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7U0FDekI7UUFDRCxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzNELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM1QyxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztJQUN6QixDQUFDO0lBQUEsQ0FBQztJQUNGLFdBQVc7UUFDVixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDdkIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQzdDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7U0FDeEM7SUFDRixDQUFDO0lBQUEsQ0FBQztJQUNGLFNBQVM7UUFDUixJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDbkMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUM1RCxDQUFDO0lBQUEsQ0FBQztJQUNGLFdBQVcsQ0FBQyxRQUFRO1FBQ25CLElBQUksUUFBUSxHQUFHO1lBQ2QsUUFBUSxFQUFFLE1BQU07WUFDaEIsZ0JBQWdCLEVBQUUsQ0FBQztZQUNuQixrQkFBa0IsRUFBRSxtQkFBbUI7U0FDdkMsQ0FBQztRQUNGLEtBQUssSUFBSSxDQUFDLElBQUksUUFBUSxFQUFFO1lBQ3ZCLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDMUI7UUFDRCxPQUFPLFFBQVEsQ0FBQztJQUNqQixDQUFDO0lBQUEsQ0FBQztJQUNGLGlCQUFpQjtJQUNqQixtQkFBbUIsQ0FBQyxDQUFDO1FBQ3BCLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxRQUFRLENBQUMsYUFBYSxJQUFJLENBQUMsQ0FBQyxPQUFPLElBQUksRUFBRSxFQUFFO1lBQzlELElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztTQUNsQjtJQUNGLENBQUM7SUFBQSxDQUFDO0lBQ0Ysa0JBQWtCLENBQUMsQ0FBQztRQUNuQixJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDaEMsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2pCLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDcEI7SUFDRixDQUFDO0lBQUEsQ0FBQztJQUNGLGlCQUFpQixDQUFDLENBQUM7UUFDbEIsSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLFFBQVEsQ0FBQyxhQUFhLEVBQUU7WUFDekMsUUFBUSxDQUFDLENBQUMsT0FBTyxFQUFFO2dCQUNsQixLQUFLLEVBQUU7b0JBQ04sSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztvQkFDM0IsTUFBTTtnQkFDUCxLQUFLLEVBQUU7b0JBQ04sSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFDN0IsTUFBTTtnQkFDUCxLQUFLLEVBQUU7b0JBQ04sSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FBQyxDQUFDO29CQUM5RSxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO29CQUMvQyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxTQUFTLENBQUM7b0JBQ2xFLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztvQkFDakIsVUFBVSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO29CQUM5QyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO29CQUNwQixNQUFNO2FBQ1A7U0FDRDtJQUNGLENBQUM7SUFBQSxDQUFDO0lBRUYsaUJBQWlCLENBQUMsQ0FBQztRQUNsQixJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7UUFDaEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFO1lBQy9CLElBQUksRUFBRSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFdBQVcsRUFBRSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRSxFQUFFO2dCQUN6RyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7YUFDM0I7aUJBQ0k7Z0JBQ0osRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO2FBQzFCO1FBQ0YsQ0FBQyxDQUFDLENBQUM7SUFDSixDQUFDO0lBQUEsQ0FBQztJQUNGLGlCQUFpQixDQUFDLENBQUM7UUFDbEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUM7UUFDNUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDeEQsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUMvQixJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUM7UUFDekIsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNuQixVQUFVLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUFBLENBQUM7SUFDRixjQUFjLENBQUMsQ0FBQztRQUNmLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDcEMsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1NBQ2pCO0lBQ0YsQ0FBQztJQUFBLENBQUM7Q0FDRiIsImZpbGUiOiJzZWxlY3QubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIFNlbGVjdENTUzogYm9vbGVhbjtcclxuLyoqXHJcbiAqIERpbWFzIExhbmpha2EgQWR2YW5jZWQgU2VsZWN0XHJcbiAqIEBwYXJhbSB0YXJnZXQgc3RyaW5nXHJcbiAqL1xyXG5jbGFzcyBkUyB7XHJcblx0dGFyZ2V0ID0gbnVsbDtcclxuXHRzZWxlY3QgPSBudWxsO1xyXG5cdGRpc3BsYXkgPSBudWxsO1xyXG5cdGxpc3QgPSBudWxsO1xyXG5cdG9wdGlvbnMgPSBbXTtcclxuXHRpc0xhcmdlID0gZmFsc2U7XHJcblx0dmFsdWUgPSBudWxsO1xyXG5cdHNlbGVjdGVkID0gbnVsbDtcclxuXHRzZXR0aW5ncyA9IG51bGw7XHJcblx0aGlnaGxpZ2h0ZWQgPSBudWxsO1xyXG5cdGZpbHRlciA9IG51bGw7XHJcblx0Y29uc3RydWN0b3IodGFyZ2V0OiBzdHJpbmcsIHNldHRpbmdzOiB7XHJcblx0XHQvKipcclxuXHRcdCAqIFNob3VsZCB0aGUgJ2ZpbHRlciBvcHRpb25zJyBpbnB1dCBiZSBkaXNwbGF5ZWQ/XHJcblx0XHQgKi9cclxuXHRcdGZpbHRlcmVkOiAnYXV0bycsXHJcblx0XHQvKipcclxuXHRcdCAqIE1heGltdW0gZGlzcGxheWVkIHRocmVzaG9sZFxyXG5cdFx0ICogKiBXaGVuIGEgc2VsZWN0IGNvbnRhaW5zIGB4YCBvcHRpb25zIG9yIG1vcmUsIGRpc3BsYXkgdGhlIGZpbHRlciBpbnB1dC5cclxuXHRcdCAqL1xyXG5cdFx0ZmlsdGVyX3RocmVzaG9sZDogOCxcclxuXHRcdC8qKlxyXG5cdFx0ICogUGxhY2Vob2xkZXIgdGV4dCBmb3IgdGhlIGZpbHRlciBpbnB1dC5cclxuXHRcdCAqL1xyXG5cdFx0ZmlsdGVyX3BsYWNlaG9sZGVyOiAnRmlsdGVyIG9wdGlvbnMuLi4nLFxyXG5cdFx0LyoqXHJcblx0XHQgKiBBdXRvIHN0YXJ0XHJcblx0XHQgKi9cclxuXHRcdHN0YXJ0OiBmYWxzZSxcclxuXHRcdC8qKlxyXG5cdFx0ICogU2F2ZSBzZWxlY3RlZCB2YWx1ZSB0byBjYWNoZSBicm93c2VyIChzYXZpbmcgZm9yIG5leHQgcmVxdWVzdCBpbiBzYW1lIGJyb3dzZXIgYW5kIHBhZ2VzKVxyXG5cdFx0ICovXHJcblx0XHRzYXZlOiBmYWxzZVxyXG5cdH0pIHtcclxuXHRcdHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xyXG5cdFx0dGhpcy5zZWxlY3QgPSBudWxsO1xyXG5cdFx0dGhpcy5kaXNwbGF5ID0gbnVsbDtcclxuXHRcdHRoaXMubGlzdCA9IG51bGw7XHJcblx0XHR0aGlzLm9wdGlvbnMgPSBbXTtcclxuXHRcdHRoaXMuaXNMYXJnZSA9IGZhbHNlO1xyXG5cdFx0dGhpcy52YWx1ZSA9IG51bGw7XHJcblx0XHR0aGlzLnNlbGVjdGVkID0gbnVsbDtcclxuXHRcdHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncztcclxuXHRcdHRoaXMuaGlnaGxpZ2h0ZWQgPSBudWxsO1xyXG5cdFx0aWYgKHNldHRpbmdzLmhhc093blByb3BlcnR5KCdzdGFydCcpICYmIHNldHRpbmdzLnN0YXJ0KSB0aGlzLmluaXQoKTtcclxuXHR9XHJcblx0LyoqXHJcblx0ICogSW5pdGlhbGl6ZSBTZWxlY3RcclxuXHQgKi9cclxuXHRpbml0KCkge1xyXG5cdFx0c3dpdGNoICh0eXBlb2YgdGhpcy50YXJnZXQpIHtcclxuXHRcdFx0Y2FzZSAnb2JqZWN0JzpcclxuXHRcdFx0XHR0aGlzLnRhcmdldCA9IHRoaXMudGFyZ2V0O1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRjYXNlICdzdHJpbmcnOlxyXG5cdFx0XHRcdHRoaXMudGFyZ2V0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLnRhcmdldCk7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHR9XHJcblx0XHRpZiAoIVNlbGVjdENTUyAmJiB0aGlzLnNldHRpbmdzLmhhc093blByb3BlcnR5KCdjc3MnKSkge1xyXG5cdFx0XHRTZWxlY3RDU1MgPSB0cnVlO1xyXG5cdFx0XHR0aGlzLmxvYWRDc3ModGhpcy5zZXR0aW5ncy5jc3MpO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5zZXR0aW5ncyA9IHRoaXMuZ2V0U2V0dGluZ3ModGhpcy5zZXR0aW5ncyk7XHJcblx0XHR0aGlzLmJ1aWxkU2VsZWN0KCk7XHJcblx0XHR0aGlzLnRhcmdldC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZCh0aGlzLnNlbGVjdCwgdGhpcy50YXJnZXQpO1xyXG5cdFx0dGhpcy50YXJnZXQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuXHRcdHRoaXMuc2VsZWN0LmFwcGVuZENoaWxkKHRoaXMudGFyZ2V0KTtcclxuXHRcdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5oYW5kbGVDbGlja09mZi5iaW5kKHRoaXMpKTtcclxuXHRcdHRoaXMucG9zaXRpb25MaXN0KCk7XHJcblx0fVxyXG5cdGxvYWRDc3ModXJsOiBzdHJpbmcpIHtcclxuXHRcdHZhciBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxpbmtcIik7XHJcblx0XHRsaW5rLnR5cGUgPSBcInRleHQvY3NzXCI7XHJcblx0XHRsaW5rLnJlbCA9IFwic3R5bGVzaGVldFwiO1xyXG5cdFx0bGluay5ocmVmID0gdXJsO1xyXG5cdFx0ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJoZWFkXCIpWzBdLmFwcGVuZENoaWxkKGxpbmspO1xyXG5cdH1cclxuXHRidWlsZFNlbGVjdCgpIHtcclxuXHRcdHRoaXMuc2VsZWN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHR0aGlzLnNlbGVjdC5jbGFzc0xpc3QuYWRkKCdzZWxlY3QnKTtcclxuXHRcdHRoaXMuc2VsZWN0LnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCB0aGlzLnRhcmdldC50YWJJbmRleCk7XHJcblx0XHR0aGlzLnNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5oYW5kbGVTZWxlY3RLZXlkb3duLmJpbmQodGhpcykpO1xyXG5cdFx0dGhpcy5kaXNwbGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG5cdFx0dGhpcy5kaXNwbGF5LmNsYXNzTGlzdC5hZGQoJ3ZhbHVlJyk7XHJcblx0XHR0aGlzLmRpc3BsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhhbmRsZURpc3BsYXlDbGljay5iaW5kKHRoaXMpKTtcclxuXHRcdHRoaXMuc2VsZWN0LmFwcGVuZENoaWxkKHRoaXMuZGlzcGxheSk7XHJcblx0XHR0aGlzLmJ1aWxkTGlzdCgpO1xyXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5sZW5ndGgpIHtcclxuXHRcdFx0dGhpcy52YWx1ZSA9IHRoaXMub3B0aW9uc1t0aGlzLnRhcmdldC5zZWxlY3RlZEluZGV4XS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnKTtcclxuXHRcdFx0dGhpcy5zZWxlY3RlZCA9IHRoaXMub3B0aW9uc1t0aGlzLnRhcmdldC5zZWxlY3RlZEluZGV4XTtcclxuXHRcdFx0dGhpcy5kaXNwbGF5LmlubmVySFRNTCA9IHRoaXMuc2VsZWN0ZWQuaW5uZXJIVE1MO1xyXG5cdFx0fVxyXG5cdFx0aWYgKCh0aGlzLnNldHRpbmdzLmZpbHRlcmVkID09PSAnYXV0bycgJiYgdGhpcy5vcHRpb25zLmxlbmd0aCA+PSB0aGlzLnNldHRpbmdzLmZpbHRlcl90aHJlc2hvbGQpIHx8XHJcblx0XHRcdHRoaXMuc2V0dGluZ3MuZmlsdGVyZWQgPT09IHRydWUpIHtcclxuXHRcdFx0dGhpcy5pc0xhcmdlID0gdHJ1ZTtcclxuXHRcdFx0dGhpcy5zZWxlY3QuY2xhc3NMaXN0LmFkZCgnbGFyZ2UnKTtcclxuXHRcdH1cclxuXHR9XHJcblx0YnVpbGRMaXN0KCkge1xyXG5cdFx0dGhpcy5saXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHR0aGlzLmxpc3QuY2xhc3NMaXN0LmFkZCgnbGlzdCcpO1xyXG5cdFx0dGhpcy5saXN0LnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnLTEnKTtcclxuXHRcdHRoaXMubGlzdC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5oYW5kbGVMaXN0S2V5ZG93bi5iaW5kKHRoaXMpKTtcclxuXHRcdHRoaXMubGlzdC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgZnVuY3Rpb24gKCkge1xyXG5cdFx0XHR0aGlzLm9wdGlvbnNbdGhpcy5oaWdobGlnaHRlZF0uY2xhc3NMaXN0LnJlbW92ZSgnaG92ZXJlZCcpO1xyXG5cdFx0fS5iaW5kKHRoaXMpKTtcclxuXHRcdHRoaXMuaGlnaGxpZ2h0ZWQgPSB0aGlzLnRhcmdldC5zZWxlY3RlZEluZGV4O1xyXG5cdFx0dGhpcy5idWlsZEZpbHRlcigpO1xyXG5cdFx0dGhpcy5idWlsZE9wdGlvbnMoKTtcclxuXHRcdHRoaXMuc2VsZWN0LmFwcGVuZENoaWxkKHRoaXMubGlzdCk7XHJcblx0fVxyXG5cdGJ1aWxkT3B0aW9ucygpIHtcclxuXHRcdHZhciB1bCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XHJcblx0XHR2YXIgb3B0aW9ucyA9IHRoaXMudGFyZ2V0LnF1ZXJ5U2VsZWN0b3JBbGwoJ29wdGlvbicpO1xyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHZhciBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcblx0XHRcdGxpLnNldEF0dHJpYnV0ZSgnZGF0YS12YWx1ZScsIG9wdGlvbnNbaV0udmFsdWUpO1xyXG5cdFx0XHRsaS5pbm5lckhUTUwgPSBvcHRpb25zW2ldLmlubmVySFRNTDtcclxuXHRcdFx0bGkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhhbmRsZU9wdGlvbkNsaWNrLmJpbmQodGhpcykpO1xyXG5cdFx0XHR1bC5hcHBlbmRDaGlsZChsaSk7XHJcblx0XHRcdHRoaXMub3B0aW9ucy5wdXNoKGxpKTtcclxuXHRcdH1cclxuXHRcdHRoaXMubGlzdC5hcHBlbmRDaGlsZCh1bCk7XHJcblx0fVxyXG5cdGJ1aWxkRmlsdGVyKCkge1xyXG5cdFx0dmFyIHdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuXHRcdHdyYXBwZXIuY2xhc3NMaXN0LmFkZCgnZmlsdGVyJyk7XHJcblx0XHR0aGlzLmZpbHRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XHJcblx0XHR0aGlzLmZpbHRlci50eXBlID0gJ3RleHQnO1xyXG5cdFx0dGhpcy5maWx0ZXIuc2V0QXR0cmlidXRlKCdwbGFjZWhvbGRlcicsIHRoaXMuc2V0dGluZ3MuZmlsdGVyX3BsYWNlaG9sZGVyKTtcclxuXHRcdHRoaXMuZmlsdGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5oYW5kbGVGaWx0ZXJLZXl1cC5iaW5kKHRoaXMpKTtcclxuXHRcdHdyYXBwZXIuYXBwZW5kQ2hpbGQodGhpcy5maWx0ZXIpO1xyXG5cdFx0dGhpcy5saXN0LmFwcGVuZENoaWxkKHdyYXBwZXIpO1xyXG5cdH1cclxuXHR0b2dnbGVMaXN0KCkge1xyXG5cdFx0aWYgKHRoaXMubGlzdC5jbGFzc0xpc3QuY29udGFpbnMoJ29wZW4nKSkge1xyXG5cdFx0XHR0aGlzLmxpc3QuY2xhc3NMaXN0LnJlbW92ZSgnb3BlbicpO1xyXG5cdFx0XHR0aGlzLm9wdGlvbnNbdGhpcy5oaWdobGlnaHRlZF0uY2xhc3NMaXN0LnJlbW92ZSgnaG92ZXJlZCcpO1xyXG5cdFx0XHR0aGlzLnNlbGVjdC5mb2N1cygpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMub3B0aW9uc1t0aGlzLnRhcmdldC5zZWxlY3RlZEluZGV4XS5jbGFzc0xpc3QuYWRkKCdob3ZlcmVkJyk7XHJcblx0XHRcdHRoaXMuaGlnaGxpZ2h0ZWQgPSB0aGlzLnRhcmdldC5zZWxlY3RlZEluZGV4O1xyXG5cdFx0XHR0aGlzLmxpc3QuY2xhc3NMaXN0LmFkZCgnb3BlbicpO1xyXG5cdFx0XHR0aGlzLmxpc3QuZm9jdXMoKTtcclxuXHRcdH1cclxuXHR9XHJcblx0cG9zaXRpb25MaXN0KCkge1xyXG5cdFx0aWYgKCF0aGlzLmlzTGFyZ2UpIHtcclxuXHRcdFx0dGhpcy5saXN0LnN0eWxlLnRvcCA9ICctJyArIHRoaXMuc2VsZWN0ZWQub2Zmc2V0VG9wICsgJ3B4JztcclxuXHRcdH1cclxuXHR9XHJcblx0aGlnaGxpZ2h0T3B0aW9uKGRpcikge1xyXG5cdFx0dmFyIG5leHQgPSBudWxsO1xyXG5cdFx0c3dpdGNoIChkaXIpIHtcclxuXHRcdFx0Y2FzZSAndXAnOlxyXG5cdFx0XHRcdG5leHQgPSAodGhpcy5oaWdobGlnaHRlZCAtIDEgPCAwKSA/IHRoaXMuaGlnaGxpZ2h0ZWQgOiB0aGlzLmhpZ2hsaWdodGVkIC0gMTtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdFx0Y2FzZSAnZG93bic6XHJcblx0XHRcdFx0bmV4dCA9ICh0aGlzLmhpZ2hsaWdodGVkICsgMSA+IHRoaXMub3B0aW9ucy5sZW5ndGggLSAxKSA/IHRoaXMuaGlnaGxpZ2h0ZWQgOiB0aGlzLmhpZ2hsaWdodGVkICsgMTtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdFx0ZGVmYXVsdDpcclxuXHRcdFx0XHRuZXh0ID0gdGhpcy5oaWdobGlnaHRlZDtcclxuXHRcdH1cclxuXHRcdHRoaXMub3B0aW9uc1t0aGlzLmhpZ2hsaWdodGVkXS5jbGFzc0xpc3QucmVtb3ZlKCdob3ZlcmVkJyk7XHJcblx0XHR0aGlzLm9wdGlvbnNbbmV4dF0uY2xhc3NMaXN0LmFkZCgnaG92ZXJlZCcpO1xyXG5cdFx0dGhpcy5oaWdobGlnaHRlZCA9IG5leHQ7XHJcblx0fVxyXG5cdGNsZWFyRmlsdGVyKCkge1xyXG5cdFx0dGhpcy5maWx0ZXIudmFsdWUgPSAnJztcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5vcHRpb25zLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHRoaXMub3B0aW9uc1tpXS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuXHRcdH1cclxuXHR9XHJcblx0Y2xvc2VMaXN0KCkge1xyXG5cdFx0dGhpcy5saXN0LmNsYXNzTGlzdC5yZW1vdmUoJ29wZW4nKTtcclxuXHRcdHRoaXMub3B0aW9uc1t0aGlzLmhpZ2hsaWdodGVkXS5jbGFzc0xpc3QucmVtb3ZlKCdob3ZlcmVkJyk7XHJcblx0fVxyXG5cdGdldFNldHRpbmdzKHNldHRpbmdzKSB7XHJcblx0XHR2YXIgZGVmYXVsdHMgPSB7XHJcblx0XHRcdGZpbHRlcmVkOiAnYXV0bycsXHJcblx0XHRcdGZpbHRlcl90aHJlc2hvbGQ6IDgsXHJcblx0XHRcdGZpbHRlcl9wbGFjZWhvbGRlcjogJ0ZpbHRlciBvcHRpb25zLi4uJ1xyXG5cdFx0fVxyXG5cdFx0Zm9yICh2YXIgcCBpbiBzZXR0aW5ncykge1xyXG5cdFx0XHRkZWZhdWx0c1twXSA9IHNldHRpbmdzW3BdO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGRlZmF1bHRzO1xyXG5cdH1cclxuXHQvLyBFVkVOVCBIQU5ETEVSU1xyXG5cdGhhbmRsZVNlbGVjdEtleWRvd24oZSkge1xyXG5cdFx0aWYgKHRoaXMuc2VsZWN0ID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmIGUua2V5Q29kZSA9PSAzMikge1xyXG5cdFx0XHR0aGlzLnRvZ2dsZUxpc3QoKTtcclxuXHRcdH1cclxuXHR9XHJcblx0aGFuZGxlRGlzcGxheUNsaWNrKGUpIHtcclxuXHRcdHRoaXMubGlzdC5jbGFzc0xpc3QuYWRkKCdvcGVuJyk7XHJcblx0XHRpZiAodGhpcy5pc0xhcmdlKSB7XHJcblx0XHRcdHRoaXMuZmlsdGVyLmZvY3VzKCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdGhhbmRsZUxpc3RLZXlkb3duKGUpIHtcclxuXHRcdGlmICh0aGlzLmxpc3QgPT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpIHtcclxuXHRcdFx0c3dpdGNoIChlLmtleUNvZGUpIHtcclxuXHRcdFx0XHRjYXNlIDM4OlxyXG5cdFx0XHRcdFx0dGhpcy5oaWdobGlnaHRPcHRpb24oJ3VwJyk7XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRjYXNlIDQwOlxyXG5cdFx0XHRcdFx0dGhpcy5oaWdobGlnaHRPcHRpb24oJ2Rvd24nKTtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdGNhc2UgMTM6XHJcblx0XHRcdFx0XHR0aGlzLnRhcmdldC52YWx1ZSA9IHRoaXMub3B0aW9uc1t0aGlzLmhpZ2hsaWdodGVkXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnKTtcclxuXHRcdFx0XHRcdHRoaXMuc2VsZWN0ZWQgPSB0aGlzLm9wdGlvbnNbdGhpcy5oaWdobGlnaHRlZF07XHJcblx0XHRcdFx0XHR0aGlzLmRpc3BsYXkuaW5uZXJIVE1MID0gdGhpcy5vcHRpb25zW3RoaXMuaGlnaGxpZ2h0ZWRdLmlubmVySFRNTDtcclxuXHRcdFx0XHRcdHRoaXMuY2xvc2VMaXN0KCk7XHJcblx0XHRcdFx0XHRzZXRUaW1lb3V0KHRoaXMucG9zaXRpb25MaXN0LmJpbmQodGhpcyksIDIwMCk7XHJcblx0XHRcdFx0XHR0aGlzLnNlbGVjdC5mb2N1cygpO1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGhhbmRsZUZpbHRlcktleXVwKGUpIHtcclxuXHRcdHZhciBzZWxmID0gdGhpcztcclxuXHRcdHRoaXMub3B0aW9ucy5maWx0ZXIoZnVuY3Rpb24gKGxpKSB7XHJcblx0XHRcdGlmIChsaS5pbm5lckhUTUwuc3Vic3RyaW5nKDAsIHNlbGYuZmlsdGVyLnZhbHVlLmxlbmd0aCkudG9Mb3dlckNhc2UoKSA9PSBzZWxmLmZpbHRlci52YWx1ZS50b0xvd2VyQ2FzZSgpKSB7XHJcblx0XHRcdFx0bGkuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0bGkuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fVxyXG5cdGhhbmRsZU9wdGlvbkNsaWNrKGUpIHtcclxuXHRcdHRoaXMuZGlzcGxheS5pbm5lckhUTUwgPSBlLnRhcmdldC5pbm5lckhUTUw7XHJcblx0XHR0aGlzLnRhcmdldC52YWx1ZSA9IGUudGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS12YWx1ZScpO1xyXG5cdFx0dGhpcy52YWx1ZSA9IHRoaXMudGFyZ2V0LnZhbHVlO1xyXG5cdFx0dGhpcy5zZWxlY3RlZCA9IGUudGFyZ2V0O1xyXG5cdFx0dGhpcy5jbG9zZUxpc3QoKTtcclxuXHRcdHRoaXMuY2xlYXJGaWx0ZXIoKTtcclxuXHRcdHNldFRpbWVvdXQodGhpcy5wb3NpdGlvbkxpc3QuYmluZCh0aGlzKSwgMjAwKTtcclxuXHR9XHJcblx0aGFuZGxlQ2xpY2tPZmYoZSkge1xyXG5cdFx0aWYgKCF0aGlzLnNlbGVjdC5jb250YWlucyhlLnRhcmdldCkpIHtcclxuXHRcdFx0dGhpcy5jbG9zZUxpc3QoKTtcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbiJdfQ==
